{{define "sessions_partial.html"}}
{{range .Sessions}}
<div class="session-card-new">
    <div class="session-card-header">
        <div class="session-info">
            {{if isValidPrompt .FirstPrompt}}
            <h3 class="session-title">{{truncate .FirstPrompt 60}}</h3>
            {{else if .Summary}}
            <h3 class="session-title">{{truncate .Summary 60}}</h3>
            {{else}}
            <h3 class="session-title">Session {{truncateID .SessionID 8}}</h3>
            {{end}}
            <span class="session-id-badge">{{truncateID .SessionID 12}}</span>
        </div>
        {{if .GitBranch}}
        <span class="session-branch-badge">
            <svg class="branch-icon" viewBox="0 0 16 16" fill="currentColor">
                <path d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25z"/>
            </svg>
            {{.GitBranch}}
        </span>
        {{end}}
    </div>

    {{if .Summary}}
    <p class="session-prompt">{{truncate .Summary 120}}</p>
    {{end}}

    <div class="session-meta-row">
        {{if .HasTasks}}
        <span class="session-meta-item has-tasks">
            <svg viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2h12v2H2V2zm0 4h12v2H2V6zm0 4h8v2H2v-2z"/>
            </svg>
            {{.TaskCount}} tasks
        </span>
        {{end}}
        <span class="session-meta-item">
            <svg viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0a8 8 0 100 16A8 8 0 008 0zm0 14A6 6 0 118 2a6 6 0 010 12zm1-6.5V4H7v5h4V7.5H9z"/>
            </svg>
            {{formatTime .Modified}}
        </span>
    </div>

    <div class="session-actions">
        {{if .HasTasks}}
        <a href="/lists/{{.SessionID}}" class="btn btn-secondary btn-sm">
            <svg viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2h12v2H2V2zm0 4h12v2H2V6zm0 4h8v2H2v-2z"/>
            </svg>
            View Tasks
        </a>
        <a href="/lists/{{.SessionID}}/graph" class="btn btn-secondary btn-sm">
            <svg viewBox="0 0 16 16" fill="currentColor">
                <path d="M4 3a2 2 0 100 4 2 2 0 000-4zm8 2a2 2 0 100 4 2 2 0 000-4zm-4 6a2 2 0 100 4 2 2 0 000-4z"/>
            </svg>
            Graph
        </a>
        {{end}}
    </div>
</div>
{{end}}

{{if .HasMore}}
<div class="load-more-container"
     hx-get="/partials/sessions/{{.ProjectID}}?offset={{.NextOffset}}"
     hx-trigger="revealed"
     hx-swap="outerHTML"
     hx-indicator="#global-loader">
    <div class="skeleton" style="height: 80px; margin-bottom: var(--space-3);"></div>
</div>
{{end}}
{{end}}
